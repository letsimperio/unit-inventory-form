<!DOCTYPE html>
<html>
<head>
  <title>Unit Inventory Form</title>
  <!-- Include necessary stylesheets -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    /* Custom CSS */
    body {
      font-family: Arial, sans-serif;
      background-color: #f3f3fe;
      margin: 0;
      padding: 20px;
    }
    .form-all {
      max-width: 750px;
      margin: 0 auto;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
    }
    .form-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .form-line {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #2c3344;
    }
    .form-required {
      color: red;
    }
    .form-textbox,
    .form-dropdown {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .form-matrix-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .form-matrix-table th,
    .form-matrix-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .form-submit-button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }
    .form-submit-button:hover {
      background-color: #45a049;
    }
    .form-sub-label {
      font-size: 12px;
      color: #464d5e;
    }
    /* Responsive Styles */
    @media screen and (max-width: 600px) {
      .form-all {
        padding: 15px;
      }
      .form-header {
        font-size: 24px;
      }
      .form-label {
        font-size: 14px;
      }
      .form-textbox,
      .form-dropdown {
        padding: 6px;
      }
      .form-matrix-table th,
      .form-matrix-table td {
        padding: 6px;
      }
      .form-submit-button {
        padding: 10px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- Your Form Starts Here -->
  <form action="https://submit.jotform.com/submit/242692850322961" method="post" id="unit_inventory_form" accept-charset="utf-8" autocomplete="on">
    <!-- Hidden Inputs -->
    <input type="hidden" name="formID" value="242692850322961" />
    <input type="hidden" name="simple_spc" value="242692850322961-242692850322961" />
    <!-- Form Content -->
    <div class="form-all">
      <h1 class="form-header">Unit Inventory</h1>

      <!-- Date Field -->
      <div class="form-line">
        <label class="form-label" for="date_field">Date<span class="form-required">*</span></label>
        <input type="text" id="date_field" name="q3_date" class="form-textbox" required placeholder="MM-DD-YYYY" />
      </div>

      <!-- City Field -->
      <div class="form-line">
        <label class="form-label" for="city_field">City<span class="form-required">*</span></label>
        <select id="city_field" name="q5_city" class="form-dropdown" required>
          <option value="">Please Select</option>
          <option value="SF">SF</option>
          <option value="LA">LA</option>
          <option value="CHI">CHI</option>
          <option value="MIA">MIA</option>
          <option value="LSV">LSV</option>
          <option value="DAL">DAL</option>
          <option value="ATX">ATX</option>
        </select>
      </div>

      <!-- Inventory Audit Field -->
      <div class="form-line">
        <label class="form-label">Inventory Audit<span class="form-required">*</span></label>
        <table class="form-matrix-table">
          <tr>
            <th>Item</th>
            <th>Previous Count</th>
            <th>New Count</th>
          </tr>
          <!-- Row 1 -->
          <tr>
            <td>InStock-Operational Screens</td>
            <td><input type="number" id="prev_count_0" name="q6_inventoryAudit[0][0]" readonly /></td>
            <td><input type="number" id="new_count_0" name="q6_inventoryAudit[0][1]" required /></td>
          </tr>
          <!-- Row 2 -->
          <tr>
            <td>InStock-Non Operational Repairable</td>
            <td><input type="number" id="prev_count_1" name="q6_inventoryAudit[1][0]" readonly /></td>
            <td><input type="number" id="new_count_1" name="q6_inventoryAudit[1][1]" required /></td>
          </tr>
          <!-- Row 3 -->
          <tr>
            <td>InStock-Permanently Non Op</td>
            <td><input type="number" id="prev_count_2" name="q6_inventoryAudit[2][0]" readonly /></td>
            <td><input type="number" id="new_count_2" name="q6_inventoryAudit[2][1]" required /></td>
          </tr>
          <!-- Row 4 -->
          <tr>
            <td>LED Panels</td>
            <td><input type="number" id="prev_count_3" name="q6_inventoryAudit[3][0]" readonly /></td>
            <td><input type="number" id="new_count_3" name="q6_inventoryAudit[3][1]" required /></td>
          </tr>
          <!-- Row 5 -->
          <tr>
            <td>E62 NA Boards</td>
            <td><input type="number" id="prev_count_4" name="q6_inventoryAudit[4][0]" readonly /></td>
            <td><input type="number" id="new_count_4" name="q6_inventoryAudit[4][1]" required /></td>
          </tr>
          <!-- Row 6 -->
          <tr>
            <td>E62 EU Boards</td>
            <td><input type="number" id="prev_count_5" name="q6_inventoryAudit[5][0]" readonly /></td>
            <td><input type="number" id="new_count_5" name="q6_inventoryAudit[5][1]" required /></td>
          </tr>
          <!-- Row 7 -->
          <tr>
            <td>L20 Boards</td>
            <td><input type="number" id="prev_count_6" name="q6_inventoryAudit[6][0]" readonly /></td>
            <td><input type="number" id="new_count_6" name="q6_inventoryAudit[6][1]" required /></td>
          </tr>
        </table>
      </div>

      <!-- Submit Button -->
      <div class="form-line">
        <button type="submit" class="form-submit-button">Submit</button>
      </div>
    </div>
  </form>

  <!-- Include necessary scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // Initialize the date picker
    flatpickr("#date_field", {
      dateFormat: "m-d-Y",
      allowInput: true
    });

    // Function to handle data from the API
    function handleData(data) {
      if (data.error) {
        alert(data.error);
      } else {
        // Populate the form fields with the data
        document.getElementById('prev_count_0').value = data.op_screens;
        document.getElementById('prev_count_1').value = data.non_op_repairable;
        document.getElementById('prev_count_2').value = data.non_op_permanent;
        document.getElementById('prev_count_3').value = data.led_panels;
        document.getElementById('prev_count_4').value = data.e62_na_boards;
        document.getElementById('prev_count_5').value = data.e62_eu_boards;
        document.getElementById('prev_count_6').value = data.l20_boards;
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      var citySelect = document.getElementById('city_field');

      citySelect.addEventListener('change', function() {
        var selectedCity = citySelect.value;
        if (selectedCity) {
          fetchData(selectedCity);
        } else {
          // Clear the fields if no city is selected
          for (var i = 0; i <= 6; i++) {
            document.getElementById('prev_count_' + i).value = '';
          }
        }
      });

      // Function to fetch data using JSONP
      function fetchData(city) {
        var callbackName = 'handleData';

        // Remove existing script tag if it exists
        var existingScript = document.getElementById('jsonpScript');
        if (existingScript) {
          existingScript.parentNode.removeChild(existingScript);
        }

        // Create a script tag
        var script = document.createElement('script');
        script.id = 'jsonpScript';
        script.src = 'https://script.google.com/macros/s/AKfycbx20PuMO0yGppFAWkrCvNinFDDdfKRNyGPbaT58l5H_yyuomHSBK3DRxtLilnYAQxPerw/exec?city=' + encodeURIComponent(city) + '&callback=' + callbackName;

        // Append the script tag to the document
        document.body.appendChild(script);
      }
    });
  </script>
</body>
</html>
